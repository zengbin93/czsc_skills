---
name: signal-generator
description: 基于缠论生成交易信号。当需要根据K线分析结果生成买卖信号、判断买卖点、识别背驰或评估趋势强度时使用此技能。适用于：(1) 生成买卖点信号 (2) 识别背驰信号 (3) 判断趋势信号 (4) 组合多种信号进行综合判断
---

# 信号生成器

## 概述

基于缠论的分型、笔、线段等结构，生成实际可用的交易信号。本技能帮助将缠论分析转化为具体的交易决策。

## 信号类型

### 1. 买卖点信号

#### 第一类买卖点
- **第一类买点**：下跌趋势后，出现向上笔不创新低
- **第一类卖点**：上涨趋势后，出现向下笔不创新高

#### 第二类买卖点
- **第二类买点**：第一类买点后，回调不破前低
- **第二类卖点**：第一类卖点后，反弹不破前高

#### 第三类买卖点  
- **第三类买点**：向上离开中枢后的回调买点
- **第三类卖点**：向下离开中枢后的反弹卖点

### 2. 背驰信号

#### 盘整背驰
- 在盘整走势中，力度衰竭
- 价格创新高/新低，但MACD不创新高/新低

#### 趋势背驰
- 在趋势走势中，力度衰竭
- 价格创新高/新低，但指标不配合

### 3. 趋势信号

#### 趋势方向
- **上涨趋势**：笔的高低点抬升
- **下跌趋势**：笔的高低点下降
- **震荡趋势**：笔的高低点无明显方向

#### 趋势强度
- **强势**：笔长、幅度大、速度快
- **弱势**：笔短、幅度小、速度慢

## 工作流程

### 1. 数据准备

需要以下数据作为输入：
```python
{
    "klines": [...],        # K线数据
    "fractals": [...],      # 分型列表
    "bis": [...],           # 笔列表
    "segments": [...],      # 线段列表（可选）
    "zhongshu": [...]       # 中枢列表（可选）
}
```

### 2. 信号生成流程

```
Step 1: 识别当前市场结构
  - 判断当前趋势方向
  - 识别关键支撑阻力
  - 定位当前位置

Step 2: 应用信号规则
  - 检查买卖点条件
  - 检测背驰情况
  - 评估趋势强度

Step 3: 生成信号
  - 确定信号类型
  - 计算信号强度
  - 设置置信度

Step 4: 输出建议
  - 给出操作建议
  - 设置止损止盈
  - 评估风险收益比
```

### 3. 信号验证

生成信号后需要验证：
- 信号是否符合缠论逻辑
- 多个信号是否相互印证
- 当前市场环境是否适合
- 风险是否可控

## 使用示例

### 示例 1：买卖点信号

用户请求：
```
根据这组K线数据生成买卖点信号

[K线数据...]
```

处理步骤：
1. 识别分型和笔
2. 判断趋势结构
3. 检查买卖点条件
4. 生成信号并给出建议

### 示例 2：背驰信号

用户请求：
```
帮我判断当前是否存在背驰
```

处理步骤：
1. 对比最近两段走势
2. 比较价格和指标
3. 判断是否背驰
4. 评估背驰强度

### 示例 3：综合信号

用户请求：
```
综合分析当前市场，给出交易建议
```

处理步骤：
1. 生成所有类型信号
2. 分析信号一致性
3. 综合判断方向
4. 给出具体操作建议

## 信号强度评估

### 强度等级

- **强烈信号**（★★★）：多个条件同时满足
- **中等信号**（★★）：主要条件满足
- **弱信号**（★）：部分条件满足

### 评估因素

1. **结构完整性**：缠论结构是否完整清晰
2. **多重验证**：是否有多个信号印证
3. **市场环境**：是否符合当前市场状态
4. **风险收益比**：潜在收益是否大于风险

## 信号组合策略

### 趋势跟踪策略
```
IF 趋势向上 AND 出现二买 AND 无背驰:
    SIGNAL = "强烈买入" (★★★)
```

### 反转策略
```
IF 趋势向上 AND 出现一卖 AND 背驰:
    SIGNAL = "卖出" (★★)
```

### 震荡策略
```
IF 震荡区间 AND 接近下沿 AND 出现底分型:
    SIGNAL = "买入" (★)
```

## 结合 czsc 库

```python
from czsc.signals import get_default_signals

# 生成默认信号
signals = get_default_signals(czsc_obj)

# 筛选特定类型信号
buy_signals = [s for s in signals if s.signal.startswith("买")]

# 分析信号强度
for sig in buy_signals:
    print(f"{sig.k1}: {sig.k2} - {sig.v1}")
```

## 注意事项

1. **不要单独使用一个信号**：需要多个信号相互验证
2. **关注市场环境**：同样的信号在不同环境下效果不同
3. **风险控制**：任何信号都可能失效，必须设置止损
4. **信号时效性**：信号是动态的，需要实时更新
5. **避免过度交易**：不是每个信号都值得操作

## 输出格式

```json
{
  "signals": [
    {
      "type": "buy_point",
      "level": "second_buy",
      "strength": "strong",
      "confidence": 0.85,
      "price": 10.5,
      "dt": "2024-01-01 14:00",
      "reason": "二买，回调不破前低，趋势向上",
      "suggestion": {
        "action": "买入",
        "stop_loss": 10.0,
        "target": 11.5,
        "risk_reward": 3.0
      }
    }
  ],
  "summary": {
    "total": 3,
    "buy_count": 2,
    "sell_count": 1,
    "overall_direction": "bullish"
  }
}
```

## 扩展功能

- 自定义信号规则
- 信号回测验证
- 信号性能统计
- 多周期信号共振
- 量价配合分析
